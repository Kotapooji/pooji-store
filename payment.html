<!doctype html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CFYJNWF48F"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){ dataLayer.push(arguments); }
  gtag('js', new Date());
  gtag('config', 'G-TN510F1DTR', { 'debug_mode': true });
</script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Checkout — Pooji Book Store</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <header class=" container header">
    <a class="brand" href="index.html">
      <img src="images/logo.png" alt="logo">
      <div>
        <h1>Pooji Book Store</h1>
        <div class="small">Secure demo checkout</div>
      </div>
    </a>
    <nav class="nav">
      <a class="btn" href="products.html">Back to Products</a>
    </nav>
  </header>

  <main class="container">
    <section class="center">
      <h2>Payment & Delivery Details</h2>
      <p class="small">
        This is a <strong>mock payment</strong> for your project. Card details are only used for front-end validation and not actually processed.
      </p>
    </section>

    <section class="form-card" aria-labelledby="checkout-title">
      <h3 id="checkout-title">Customer & Payment Info</h3>

      <form id="checkoutForm">
        <div class="form-grid" style="margin-top:12px;">
          <!-- Customer info -->
          <input class="input" name="firstName" placeholder="First name" required>
          <input class="input" name="lastName" placeholder="Last name" required>

          <input class="input" type="email" name="email" placeholder="Email" required>
          <input class="input" type="tel" name="phone" placeholder="Phone number" required>

          <input class="input full" name="address" placeholder="Street address" required>
          <input class="input" name="city" placeholder="City" required>
          <input class="input" name="state" placeholder="State / Region" required>
          <input class="input" name="zip" placeholder="Postal code" required>

          <!-- Payment method selector -->
          <div class="full">
            <label class="small">Payment method (mock)</label>
            <div class="payment-methods">
              <label>
                <input type="radio" name="paymentMethod" value="card" checked>
                Card
              </label>
              <label>
                <input type="radio" name="paymentMethod" value="upi">
                UPI
              </label>
              <label>
                <input type="radio" name="paymentMethod" value="cod">
                Cash on delivery
              </label>
            </div>
          </div>

          <!-- Card details (shown when "card" is selected) -->
          <div class="card-section full" id="cardSection">
            <h4>Card details (mock)</h4>
            <input class="input full-mobile" name="cardName" id="cardName" placeholder="Name on card">
            <div class="card-row">
              <input class="input full-mobile" name="cardNumber" id="cardNumber" maxlength="19" placeholder="Card number (16 digits)">
              <input class="input" name="cardExpiry" id="cardExpiry" placeholder="MM/YY">
              <input class="input" name="cardCvv" id="cardCvv" placeholder="CVV">
            </div>
            <div class="secure-note">
              <span class="badge-secure">Mock • For demo only</span>
              Your card details are not sent to any server. They are only validated in the browser.
            </div>
          </div>

          <!-- Notes -->
          <textarea class="input full" name="notes" placeholder="Order notes (optional)"></textarea>
        </div>

        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:14px;gap:10px;flex-wrap:wrap;">
          <div class="small">
            Cart items: <span id="cartItems">0</span><br>
            <span id="selectedProduct" class="small"></span>
          </div>
          <div>
            <button type="button" class="btn secondary" id="backProducts">Back</button>
            <button type="submit" class="btn" id="payButton">Pay &amp; Place Order</button>
          </div>
        </div>

        <div class="small" id="statusMessage" style="margin-top:8px;"></div>
      </form>
    </section>
  </main>

  <footer class="container footer">
    <div class="small">© Pooji Book Store</div>
    <div class="small">Demo checkout for project</div>
  </footer>

<script>
  // Show cart count
  function updateCartUI(){
    const count = Number(localStorage.getItem('pooji_cart') || 0);
    document.getElementById('cartItems').textContent = count;
  }
  updateCartUI();

  // Read product from URL if coming from "Buy Now"
  const urlParams = new URLSearchParams(location.search);
  const productParam = urlParams.get('product') || null;
  const productTextEl = document.getElementById('selectedProduct');
  if(productParam){
    productTextEl.textContent = 'Selected item: ' + productParam;
  }else{
    productTextEl.textContent = 'Selected item: Cart items';
  }

  // Payment method toggle
  const methodRadios = document.querySelectorAll('input[name="paymentMethod"]');
  const cardSection = document.getElementById('cardSection');

  function updatePaymentVisibility(){
    let method = 'card';
    methodRadios.forEach(radio => { if(radio.checked) method = radio.value; });
    if(method === 'card'){
      cardSection.style.display = 'block';
    }else{
      cardSection.style.display = 'none';
    }
  }
  methodRadios.forEach(r => r.addEventListener('change', updatePaymentVisibility));
  updatePaymentVisibility();

  // Simple card validation (front-end only, fake)
  function validateCardFields(){
    const number = document.getElementById('cardNumber').value.replace(/\s+/g,'');
    const name   = document.getElementById('cardName').value.trim();
    const expiry = document.getElementById('cardExpiry').value.trim();
    const cvv    = document.getElementById('cardCvv').value.trim();

    if(!name){
      alert('Please enter name on card.');
      return false;
    }
    if(!/^\d{16}$/.test(number)){
      alert('Please enter a valid 16-digit card number (for demo).');
      return false;
    }
    if(!/^\d{2}\/\d{2}$/.test(expiry)){
      alert('Expiry should be in MM/YY format.');
      return false;
    }
    const [mmStr, yyStr] = expiry.split('/');
    const mm = Number(mmStr), yy = Number(yyStr);
    if(mm < 1 || mm > 12){
      alert('Please enter a valid expiry month.');
      return false;
    }

    if(!/^\d{3,4}$/.test(cvv)){
      alert('CVV should be 3 or 4 digits.');
      return false;
    }

    return true;
  }

  // Submit handler: mock payment simulation then redirect
  document.getElementById('checkoutForm').addEventListener('submit', function(e){
    e.preventDefault();
    const form = e.target;
    const payButton = document.getElementById('payButton');
    const statusEl = document.getElementById('statusMessage');

    // Basic required fields
    if(!form.firstName.value.trim() || !form.email.value.trim()){
      alert('Please fill in all required details (name & email).');
      return;
    }

    // Read method
    let method = 'card';
    methodRadios.forEach(radio => { if(radio.checked) method = radio.value; });

    // If card, run fake card validation
    if(method === 'card'){
      if(!validateCardFields()){
        return;
      }
    }

    // Simulate processing
    payButton.disabled = true;
    const originalText = payButton.textContent;
    payButton.textContent = 'Processing...';
    statusEl.textContent = 'Simulating payment… This is just for demo, no real money is charged.';

    // Build a fake order summary
    const order = {
      id: 'POOJI-' + Date.now(),
      name: form.firstName.value.trim() + (form.lastName.value ? (' ' + form.lastName.value.trim()) : ''),
      email: form.email.value.trim(),
      product: productParam || 'Cart items',
      method: method.toUpperCase(),
      timestamp: new Date().toISOString()
    };
    localStorage.setItem('pooji_last_order', JSON.stringify(order));
    localStorage.removeItem('pooji_cart'); // clear cart

    // After 1.5s, "payment success" → thankyou.html
    setTimeout(()=>{
      window.location.href = 'thankyou.html';
    }, 1500);
  });

  document.getElementById('backProducts').addEventListener('click', ()=>{
    location.href = 'products.html';
  });
</script>
</body>
</html>
