<!doctype html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-CFYJNWF48F"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TN510F1DTR');
</script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Products — Pooji Book Store</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class=" header container">
    <div class="brand">
      <img src="images/logo.png" alt="Pooji logo" />
      <div>
        <h1>Pooji Book Store</h1>
        <div class="small">Books & Coffee</div>
      </div>
    </div>
    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="products.html" class="primary">Products</a>
      <button class="cart-btn" id="openCart">Cart (<span id="cartCount">0</span>)</button>
    </nav>
  </header>

  <main class="container">
    <h2 style="margin:16px 0;">Products</h2>

    <div style="display:flex; gap:12px; margin-bottom:12px; flex-wrap:wrap;">
      <label>
        <select id="filterSelect">
          <option value="">All</option>
          <option value="Fiction">Fiction</option>
          <option value="Non-Fiction">Non-Fiction</option>
          <option value="Children">Children</option>
          <option value="Mystery">Mystery</option>
          <option value="Coffee">Coffee</option>
        </select>
      </label>

      <input id="searchInput" placeholder="Search title..." style="padding:8px 10px; border-radius:8px; border:1px solid #eee;" />
    </div>

    <div id="productGrid" class="grid"></div>

    <div id="productDetailArea" style="margin-top:18px;"></div>

    <footer class="footer">Pooji Book Store • Click a product to open its product page (detail view).</footer>
  </main>

  <script>
    // Sample product data - replace/expand as needed.
    const PRODUCTS = [
      { id: 'book1', type:'Book', genre:'Fiction', title:'The Starlit Path', price:349, img:'images/book-fiction-1.jpg', desc:'A touching novel about journeys and home.' },
      { id: 'book2', type:'Book', genre:'Non-Fiction', title:'Mindful Living', price:299, img:'images/book-nonfiction-1.jpg', desc:'Practical tips for a calmer, focused life.' },
      { id: 'book3', type:'Book', genre:'Mystery', title:'Shadows on the Lane', price:399, img:'images/book-mystery-1.jpg', desc:'A twisting detective story with surprises.' },
      { id: 'coffee1', type:'Coffee', genre:'Coffee', title:'House Espresso (250g)', price:599, img:'images/coffee-espresso.jpg', desc:'Rich, chocolatey single-origin espresso.' },
      { id: 'coffee2', type:'Coffee', genre:'Coffee', title:'Cold Brew Blend (250g)', price:649, img:'images/coffee-coldbrew.jpg', desc:'Smooth cold brew blend with toffee notes.' }
      // Add more items and images as you upload them to GitHub
    ];

    const grid = document.getElementById('productGrid');
    const detailArea = document.getElementById('productDetailArea');

    function renderGrid(filter='', query=''){
      grid.innerHTML = '';
      const items = PRODUCTS.filter(p => {
        if(filter && p.genre !== filter && (filter !== 'Coffee' || p.genre!=='Coffee')) return false;
        if(query && !p.title.toLowerCase().includes(query.toLowerCase())) return false;
        return true;
      });
      if(items.length === 0){
        grid.innerHTML = '<div style="padding:20px; color:var(--muted)">No products match.</div>';
        return;
      }
      items.forEach(p => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="${p.img}" alt="${p.title}">
          <div class="card-body">
            <h3>${p.title}</h3>
            <p class="small">${p.desc}</p>
            <div class="meta">
              <div class="small">₹ ${p.price}</div>
              <div style="display:flex; gap:8px;">
                <a class="btn btn-outline" href="products.html?id=${p.id}">View</a>
                <button class="btn btn-primary" data-add="${p.id}">Add to Cart</button>
              </div>
            </div>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    // show product detail if URL contains ?id=...
    function showProductDetail(productId){
      const p = PRODUCTS.find(x => x.id === productId);
      if(!p) {
        detailArea.innerHTML = '';
        return;
      }
      detailArea.innerHTML = `
        <div class="product-detail">
          <div class="pd-image">
            <img src="${p.img}" alt="${p.title}" style="width:100%; height:420px; object-fit:cover;">
          </div>
          <div class="pd-content">
            <h2>${p.title}</h2>
            <div class="small" style="margin-bottom:10px;">${p.type} • ${p.genre}</div>
            <p style="color:var(--muted)">${p.desc}</p>
            <div style="margin-top:14px; display:flex; gap:12px; align-items:center;">
              <div style="font-weight:900; font-size:1.2rem;">₹ ${p.price}</div>
              <div style="margin-left:auto;">
                <button class="btn btn-primary" id="buyNow">Buy Now</button>
                <button class="btn btn-outline" id="addNow">Add to Cart</button>
              </div>
            </div>
          </div>
        </div>
      `;

      document.getElementById('addNow').addEventListener('click', ()=>{
        addToCart(p.id);
        alert('Added to cart');
        updateCartCount();
      });
      document.getElementById('buyNow').addEventListener('click', ()=>{
        // redirect to payment with buy param
        location.href = `payment.html?buy=${p.id}`;
      });
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    // add to cart stored in localStorage
    function addToCart(id){
      const cart = JSON.parse(localStorage.getItem('pooji_cart') || '[]');
      cart.push({ id, qty:1 });
      localStorage.setItem('pooji_cart', JSON.stringify(cart));
    }

    // handle add from card buttons
    grid.addEventListener('click', (e)=>{
      const id = e.target.getAttribute('data-add');
      if(id){
        addToCart(id);
        updateCartCount();
        alert('Added to cart');
      }
    });

    // filters & search
    document.getElementById('filterSelect').addEventListener('change', (e)=>{
      const v = e.target.value;
      const q = document.getElementById('searchInput').value || '';
      renderGrid(v, q);
    });
    document.getElementById('searchInput').addEventListener('input', (e)=>{
      const q = e.target.value;
      const v = document.getElementById('filterSelect').value;
      renderGrid(v, q);
    });

    // cart count
    function updateCartCount(){
      const cart = JSON.parse(localStorage.getItem('pooji_cart') || '[]');
      document.getElementById('cartCount').innerText = cart.length;
    }
    document.getElementById('openCart').addEventListener('click', ()=> location.href = 'payment.html?cart=1');

    // init
    function init(){
      const params = new URLSearchParams(location.search);
      const filter = params.get('filter') || '';
      const q = params.get('q') || '';
      renderGrid(filter, q);
      updateCartCount();

      const id = params.get('id');
      if(id) showProductDetail(id);
      // attach click delegation for Buy Now from product list (if any)
      // (cards have View which navigates to ?id=)
    }

    init();
  </script>
</body>
</html>
